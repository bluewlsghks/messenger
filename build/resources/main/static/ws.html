<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>WS STOMP Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js" defer></script>
</head>
<body>
  <h3>Room: <span id="room"></span></h3>
  <ul id="msgs"></ul>
  <input id="txt" placeholder="message"/>
  <button id="send">Send</button>

  <script>
    const ROOM_ID = '68eda88ed6451b8903b514a3';
    const ME = 'LEE';
    document.getElementById('room').textContent = ROOM_ID;

    document.addEventListener('DOMContentLoaded', () => {
      const sock = new SockJS('/ws-stomp');
      const client = Stomp.over(sock);
      client.connect({}, frame => {
        client.subscribe(`/sub/rooms/${ROOM_ID}`, msg => {
          const data = JSON.parse(msg.body);
          const li = document.createElement('li');
          li.textContent = `${data.sender}: ${data.content}`;
          document.getElementById('msgs').appendChild(li);
        });
      });

      document.getElementById('send').addEventListener('click', () => {
        const content = document.getElementById('txt').value;
        client.send('/pub/messages.send', {}, JSON.stringify({ roomId: ROOM_ID, sender: ME, content }));
      });
    });
  </script>
</body>
</html>
